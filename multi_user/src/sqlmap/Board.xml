<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="BoardDto">
    <typeAlias alias="BoardDto" type="kr.co.neodreams.multi_user.dto.BoardDto"/>

    <select id="Board#getSelectBoardList" parameterClass="BoardDto" resultClass="BoardDto">
        <![CDATA[
            SELECT seq,subject, writer, convert(nchar(10) , WTIME ,120 ) as wtime ,hit
            FROM [SPLAZA_BOARD]
            WHERE
        ]]>
        <![CDATA[
                YEAR ( WTIME) > 2014
        ]]>
        <isNotEmpty prepend="and" property="searchString">
                (Subject LIKE '%$searchString$%'
                or Content LIKE '%$searchString$%')
        </isNotEmpty>
        	AND BBSID = #bbsid#                
        order by WTIME desc
        OFFSET (#pageNo# - 1) * #perPageCnt# ROWS
         FETCH NEXT #perPageCnt# ROWS ONLY
    </select>
    
    <select id="Board#getSelectBoardDetail" parameterClass="BoardDto" resultClass="BoardDto">
    	
    </select>

    <select id="Board#getSelectBoardListCnt" parameterClass="BoardDto" resultClass="int">
        <![CDATA[
            SELECT count(*) as totalCnt
            FROM [SPLAZA_BOARD]
            WHERE
        ]]>
        <![CDATA[
                YEAR ( WTIME) > 2014
        ]]>
        <isNotEmpty prepend="and" property="searchString">
                (Subject LIKE '%$searchString$%'
                or Content LIKE '%$searchString$%')
        </isNotEmpty>
        	AND BBSID = #bbsid#   
    </select>
    
    <insert id="Board#boardInsert">
		<selectKey keyProperty="seq" resultClass="int">
			SELECT COALESCE(max(seq), 0)+1 FROM SPLAZA_BOARD
		</selectKey>
		INSERT INTO SPLAZA_BOARD (
			seq,     bbsid,     writer,    subject,     content, 
			hit,     wtime,     ip,        userid,      notice
		) VALUES (
			#seq#,	 #bbsid#,   #writer#,  #subject#,   #content#, 
			0,       getDate(), #ip#,      #userid#,    #notice#
		)
	</insert>		
	
	<insert id="Board#boardAttatchInsert" parameterClass="java.util.ArrayList">
		INSERT INTO SPLAZA_ATTATCH(
			FREQ,				SEQ,      BBSID
		)VALUES
		<iterate conjunction=",">
		(
			#List[].freq#,	#List[].seq#,   #List[].bbsid#
		)
		</iterate>
	</insert>
	
    
</sqlMap>    